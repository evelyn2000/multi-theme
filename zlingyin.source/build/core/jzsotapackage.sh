#!/system/bin/sh

OUT_DIR=$1
PRODUCT_OUT=$2
INTERNAL_OTA_PACKAGE_TARGET=$3


if [ -z ${QS_BUILD_VERNO} ]; then QS_BUILD_VERNO="1.00"; fi

if [ -z ${QS_DISABLE_DEBUGABLE} ]; then QS_DISABLE_DEBUGABLE="no"; fi

if [ -z ${MTK_CTA_SUPPORT} ]; then MTK_CTA_SUPPORT="no"; fi


echo "OUT_DIR : ${OUT_DIR}";
echo "PRODUCT_OUT : ${PRODUCT_OUT}";
echo "INTERNAL_OTA_PACKAGE_TARGET : ${INTERNAL_OTA_PACKAGE_TARGET}";

JZS_OTA_PACKAGE_NAME_PREFIX="";

if [ -z ${QS_PRJ} ]; then
  JZS_OTA_PACKAGE_NAME_PREFIX=${TARGET_PRODUCT};
else
	JZS_OTA_PACKAGE_NAME_PREFIX=${QS_PRJ};
fi

if [ -z ${MTK_MODEM_SUPPORT} ]; then 
	QS_MODEMTYPE="modem_3g";
else
	QS_MODEMTYPE=${MTK_MODEM_SUPPORT}; 
fi

JZS_OTA_PACKAGE_NAME=${QS_MODEMTYPE#*_};

if [ ! -z ${GEMINI} ]; then 
	if [ "${GEMINI}" = "yes" ]; then 
		JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_2sim
	else
		JZS_OTA_PACKAGE_NAME=$(JZS_OTA_PACKAGE_NAME)_1sim
	fi
fi

if [ ! -z ${QS_LCD_SIZE} ]; then 
	JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_${QS_LCD_SIZE}; 
fi

if [ -z ${QS_DEFALUT_LANGUAGE_DEFINED} ]; then 
	JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_eng; 
else
	JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_${QS_DEFALUT_LANGUAGE_DEFINED}; 
fi

if [ ! -z ${QS_OTA_PACKAGE_WIPE_USER_DATA} ]; then 
	if [ "${QS_OTA_PACKAGE_WIPE_USER_DATA}" = "yes" ]; then
		JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_format
	fi
fi

if [ ! -z ${QS_OTA_PACKAGE_WITH_PRELOADER} ]; then 
	if [ "${QS_OTA_PACKAGE_WITH_PRELOADER}" = "yes" ]; then
		JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_pl
	fi
fi

if [ ! -z ${MTK_BUILD_VERNO} ]; then 
TEMP_VERNO_KEY=${MTK_BUILD_VERNO#ALPS.}
if [ "${TEMP_VERNO_KEY}" != "" ]; then
TEMP_VERNO_KEY=`tr '[A-Z]' '[a-z]' <<<"$TEMP_VERNO_KEY"`;
JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_${TEMP_VERNO_KEY}.${QS_BUILD_VERNO}; 
else
JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_v${QS_BUILD_VERNO}; 
fi
else
JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_v${QS_BUILD_VERNO}; 
fi

if [ "${MTK_CTA_SUPPORT}" = "yes" ]; then
	JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_cta
fi

if [ -z ${TARGET_BUILD_VARIANT} ]; then 
	JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_debug
else	
	if [ "${TARGET_BUILD_VARIANT}" != "user" ]; then
		JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_debug
	fi
fi

TAR_SHOWTIMECMD=$(date +%Y%m%d%H)
JZS_OTA_PACKAGE_NAME=${JZS_OTA_PACKAGE_NAME}_${TAR_SHOWTIMECMD}_ota

echo "JZS_OTA_PACKAGE_NAME : ${JZS_OTA_PACKAGE_NAME}";

if [ -e ${INTERNAL_OTA_PACKAGE_TARGET} ]; then 	
	if [ ! -z ${QS_CUSTOM_DEVICE_MODEL_NAME} ]; then 
		cp -f ${INTERNAL_OTA_PACKAGE_TARGET} ${OUT_DIR}/Download/${JZS_OTA_PACKAGE_NAME_PREFIX}_${QS_CUSTOM_DEVICE_MODEL_NAME}_${JZS_OTA_PACKAGE_NAME}.zip
	else
		cp -f ${INTERNAL_OTA_PACKAGE_TARGET} ${OUT_DIR}/Download/${JZS_OTA_PACKAGE_NAME_PREFIX}_${JZS_OTA_PACKAGE_NAME}.zip
	fi

	if [ -e ${PRODUCT_OUT}/adups-otaPackage.zip ]; then 
		cp -f ${PRODUCT_OUT}/adups-otaPackage.zip ${OUT_DIR}/Download/${JZS_OTA_PACKAGE_NAME_PREFIX}_${JZS_OTA_PACKAGE_NAME}_adups.zip
	fi
else
echo "${INTERNAL_OTA_PACKAGE_TARGET} not exist...";	
fi

